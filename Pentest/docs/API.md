# API Documentation - AWS Pentest Lab

## 🔌 Endpoints

### Port Scanner

#### GET /api/scan/ports
Escanea puertos en un host objetivo.

**Request**
\`\`\`json
{
  "target": "example.com",
  "portRange": "1-1000",
  "timeout": 1000
}
\`\`\`

**Response**
\`\`\`json
{
  "openPorts": [
    {
      "port": 80,
      "service": "HTTP",
      "state": "open"
    }
  ],
  "scanDuration": "5.2s"
}
\`\`\`

### Subdomain Enumeration

#### GET /api/enum/subdomains
Enumera subdominios de un dominio objetivo.

**Request**
\`\`\`json
{
  "target": "example.com",
  "wordlist": "default"
}
\`\`\`

**Response**
\`\`\`json
{
  "subdomains": [
    {
      "subdomain": "dev.example.com",
      "ip": "192.168.1.1",
      "status": "active"
    }
  ],
  "total": 10
}
\`\`\`

### SQL Injection Scanner

#### POST /api/scan/sqli
Realiza pruebas de inyección SQL.

**Request**
\`\`\`json
{
  "target": "http://example.com/page",
  "parameter": "id",
  "method": "GET"
}
\`\`\`

**Response**
\`\`\`json
{
  "vulnerabilities": [
    {
      "type": "SQLi",
      "parameter": "id",
      "payload": "' OR '1'='1",
      "severity": "high"
    }
  ],
  "testCount": 15
}
\`\`\`

### XSS Scanner

#### POST /api/scan/xss
Realiza pruebas de Cross-Site Scripting.

**Request**
\`\`\`json
{
  "target": "http://example.com/page",
  "parameter": "search",
  "method": "POST"
}
\`\`\`

**Response**
\`\`\`json
{
  "vulnerabilities": [
    {
      "type": "XSS",
      "parameter": "search",
      "payload": "<script>alert('XSS')</script>",
      "severity": "medium"
    }
  ],
  "testCount": 20
}
\`\`\`

### S3 Scanner

#### GET /api/scan/s3
Escanea buckets S3 en busca de configuraciones incorrectas.

**Request**
\`\`\`json
{
  "bucketName": "example-bucket",
  "region": "us-west-2"
}
\`\`\`

**Response**
\`\`\`json
{
  "findings": [
    {
      "bucket": "example-bucket",
      "issue": "public_access",
      "severity": "high",
      "recommendation": "Disable public access"
    }
  ],
  "scanDuration": "3.5s"
}
\`\`\`

### IAM Analyzer

#### GET /api/analyze/iam
Analiza políticas y permisos de IAM.

**Request**
\`\`\`json
{
  "target": "user/admin",
  "type": "user"
}
\`\`\`

**Response**
\`\`\`json
{
  "findings": [
    {
      "resource": "user/admin",
      "permission": "s3:*",
      "risk": "high",
      "recommendation": "Limit S3 permissions"
    }
  ],
  "totalPermissions": 25
}
\`\`\`

## 🔐 Autenticación

### Headers Requeridos
\`\`\`
Authorization: Bearer <token>
Content-Type: application/json
\`\`\`

### Ejemplo de Autenticación
\`\`\`javascript
const headers = {
  'Authorization': `Bearer ${token}`,
  'Content-Type': 'application/json'
};

fetch('/api/scan/ports', {
  method: 'GET',
  headers,
  body: JSON.stringify(data)
});
\`\`\`

## 📊 Códigos de Estado

- \`200\`: Éxito
- \`400\`: Error en la solicitud
- \`401\`: No autorizado
- \`403\`: Prohibido
- \`404\`: No encontrado
- \`429\`: Demasiadas solicitudes
- \`500\`: Error interno del servidor

## 🔄 Rate Limiting

- Límite: 100 solicitudes por minuto
- Headers de respuesta:
  - \`X-RateLimit-Limit\`
  - \`X-RateLimit-Remaining\`
  - \`X-RateLimit-Reset\`

## 📝 Formato de Errores

\`\`\`json
{
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "Too many requests",
    "details": {
      "limit": 100,
      "reset": 1500000000
    }
  }
}
\`\`\`

## 🔍 Ejemplos de Uso

### Curl
\`\`\`bash
curl -X GET "http://localhost:3000/api/scan/ports" \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"target": "example.com", "portRange": "1-1000"}'
\`\`\`

### JavaScript
\`\`\`javascript
const scanPorts = async (target, portRange) => {
  try {
    const response = await fetch('/api/scan/ports', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ target, portRange })
    });
    
    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Error:', error);
  }
};
\`\`\`

### Python
\`\`\`python
import requests

def scan_ports(target, port_range):
    url = 'http://localhost:3000/api/scan/ports'
    headers = {
        'Authorization': f'Bearer {token}',
        'Content-Type': 'application/json'
    }
    data = {
        'target': target,
        'portRange': port_range
    }
    
    response = requests.get(url, headers=headers, json=data)
    return response.json()
\`\`\`

## 📈 Webhooks

### Configuración
\`\`\`json
{
  "url": "https://your-domain.com/webhook",
  "events": ["scan.complete", "vulnerability.found"],
  "secret": "your-webhook-secret"
}
\`\`\`

### Formato de Eventos
\`\`\`json
{
  "event": "scan.complete",
  "data": {
    "scanId": "abc123",
    "type": "port_scan",
    "results": {}
  },
  "timestamp": "2024-01-01T12:00:00Z"
}
\`\`\`

## 🔒 Seguridad

1. Usa HTTPS para todas las solicitudes
2. Implementa autenticación JWT
3. Valida todos los inputs
4. Implementa rate limiting
5. Usa CORS apropiadamente

## 📚 Recursos

- [Postman Collection](link-to-postman-collection)
- [OpenAPI Spec](link-to-openapi-spec)
- [SDK Documentation](link-to-sdk-docs) 